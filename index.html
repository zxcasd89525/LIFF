<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分享名片</title>
    <!-- 關鍵變動：將 LIFF SDK 的載入移到這裡 -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f0f0f0; }
        .container { text-align: center; }
        button { background-color: #00B900; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>柏允幫你分享名片</h1>
        <button id="shareButton">➤ 分享名片給好友</button>
    </div>

    <!-- 我們自己寫的邏輯腳本，保留在 body 的結尾 -->
    <script>
        async function main() {
            console.log("LIFF 腳本開始執行...");
            try {
                // 請再次確認您的 LIFF ID 完全正確
                await liff.init({ liffId: "2007667168-qk6mywm6" });
                console.log("liff.init() 成功！");

                const shareButton = document.getElementById('shareButton');
                if (!shareButton) {
                    console.error("錯誤：找不到 ID 為 'shareButton' 的按鈕！");
                    return;
                }
                console.log("成功找到分享按鈕。");

                shareButton.addEventListener('click', async () => {
                    console.log("分享按鈕被點擊了！");
                    
                    if (!liff.isApiAvailable('shareTargetPicker')) {
                        console.warn("API 'shareTargetPicker' 不可用（可能在外部瀏覽器中）。");
                        alert('此分享功能僅限在 LINE App 中使用。');
                        return;
                    }
                    console.log("API 'shareTargetPicker' 可用，準備呼叫...");

                    const messageToSend = [{
                        "type": "flex",
                        "altText": "這是一張電子名片",
                        "contents": {
                          "type": "bubble",
                          "hero": { "type": "image", "url": "https://i.imgur.com/rS0FfWq.png", "size": "full", "aspectRatio": "1:1", "aspectMode": "cover" },
                          "body": { "type": "box", "layout": "vertical", "spacing": "md", "contents": [ { "type": "text", "text": "您的名字", "weight": "bold", "size": "xl" }, { "type": "text", "text": "您的職稱 | XXX 公司", "color": "#aaaaaa", "size": "sm" } ] },
                          "footer": { "type": "box", "layout": "vertical", "spacing": "sm", "contents": [ { "type": "button", "style": "link", "action": { "type": "uri", "label": "前往官方網站", "uri": "https://www.google.com" } } ] }
                        }
                    }];

                    const result = await liff.shareTargetPicker(messageToSend);
                    if (result) {
                        liff.closeWindow();
                    }
                } catch (error) {
                    console.error("分享過程中發生錯誤:", error);
                    alert('分享失敗：' + error.message);
                }
            });

            console.log("分享按鈕的點擊事件已成功綁定。");

        } catch (error) {
            console.error("LIFF 初始化或執行過程中發生嚴重錯誤:", error);
        }
    }

    main();
    </script>
</body>
</html>
