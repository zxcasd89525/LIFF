<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
    async function main() {
        console.log("LIFF 腳本開始執行...");
        try {
            // --- 請再次確認您的 LIFF ID 是否完全正確 ---
            await liff.init({ liffId: "2007667168-qk6mywm6" }); 
            console.log("liff.init() 成功！");

            if (!liff.isLoggedIn()) {
                console.log("使用者未登入，準備導向登入頁面...");
                liff.login();
                return; // 登入後會重載頁面，所以這裡直接結束
            }
            console.log("使用者已登入。");

            const shareButton = document.getElementById('shareButton');
            if (!shareButton) {
                console.error("錯誤：找不到 ID 為 'shareButton' 的按鈕！請檢查 HTML。");
                return;
            }
            console.log("成功找到分享按鈕。");

            shareButton.addEventListener('click', async () => {
                console.log("分享按鈕被點擊了！");
                
                if (!liff.isApiAvailable('shareTargetPicker')) {
                    console.warn("API 'shareTargetPicker' 不可用。");
                    alert('您的 LINE 版本不支援此分享功能，請更新 LINE App。');
                    return;
                }
                console.log("API 'shareTargetPicker' 可用，準備呼叫...");

                const messageToSend = [{ /* ... 這裡的訊息內容與之前相同 ... */ }];

                try {
                    const result = await liff.shareTargetPicker(messageToSend);
                    console.log("shareTargetPicker 執行結果:", result);
                    if (result) {
                        liff.closeWindow();
                    } else {
                        console.log("使用者取消了分享。");
                    }
                } catch (error) {
                    console.error("呼叫 shareTargetPicker 時發生錯誤:", error);
                    alert('分享失敗：' + error.message);
                }
            });

            console.log("分享按鈕的點擊事件已成功綁定。");

        } catch (error) {
            console.error("LIFF 初始化或執行過程中發生嚴重錯誤:", error);
            alert("LIFF 初始化失敗，請檢查主控台錯誤訊息。");
        }
    }

    main();
</script>
